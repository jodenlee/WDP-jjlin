{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-6">
        <div class="mb-3">
            <a href="{{ url_for('activities.activities_list') }}" class="btn btn-primary btn-lg fs-4">‚Üê Back to
                Activities</a>
        </div>

        <div class="card border-0 shadow-sm">
            <div class="card-body p-4 p-md-5">
                <h1 class="fw-bold mb-4">
                    <i class="fas fa-plus-circle me-2 text-primary"></i>
                    Create Activity
                </h1>

                <form id="create-activity-form" action="{{ url_for('activities.create_activity') }}" method="POST"
                    enctype="multipart/form-data" novalidate>

                    <!-- Title -->
                    <div class="mb-3">
                        <label for="title" class="form-label fw-bold fs-5">Title</label>
                        <input type="text" class="form-control form-control-lg" id="title" name="title" maxlength="120"
                            placeholder="Give your activity a name" value="{{ request.form.get('title', '') }}">
                        <div class="invalid-feedback">Title is required.</div>
                    </div>

                    <!-- Description -->
                    <div class="mb-3">
                        <label for="description" class="form-label fw-bold fs-5">Description</label>
                        <textarea class="form-control form-control-lg" id="description" name="description" rows="4"
                            placeholder="What's this activity about?">{{ request.form.get('description', '') }}</textarea>
                        <div class="form-text">Describe the activity so others know what to expect.</div>
                    </div>

                    <!-- Attachment upload -->
                    <div class="mb-3">
                        <label for="attachment" class="form-label fw-bold fs-5">Attachment (optional)</label>
                        <input type="file" class="form-control form-control-lg" id="attachment" name="attachment"
                            accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx">
                        <div class="form-text">Upload a file with additional details (schedule, materials, etc.).
                            Allowed: JPG/PNG/GIF/PDF/DOC/DOCX (max 5MB).</div>
                    </div>

                    <div class="row">
                        <!-- Type -->
                        <div class="col-md-6 mb-3">
                            <label for="type" class="form-label fw-bold fs-5">Type</label>
                            <select class="form-select form-select-lg" id="type" name="type">
                                {% set t = request.form.get('type', '') %}
                                <option value="" {{ 'selected' if t=='' else '' }} disabled>Select type...</option>
                                <option value="Workshop" {{ 'selected' if t=='Workshop' else '' }}>Workshop</option>
                                <option value="Social" {{ 'selected' if t=='Social' else '' }}>Social Gathering</option>
                                <option value="Exercise" {{ 'selected' if t=='Exercise' else '' }}>Exercise</option>
                                <option value="Learning" {{ 'selected' if t=='Learning' else '' }}>Learning</option>
                                <option value="Community" {{ 'selected' if t=='Community' else '' }}>Community Service
                                </option>
                                <option value="Other" {{ 'selected' if t=='Other' else '' }}>Other</option>
                            </select>
                            <div class="invalid-feedback">Please select an activity type.</div>
                        </div>

                        <!-- Date -->
                        <div class="col-md-6 mb-3">
                            <label for="event_date" class="form-label fw-bold fs-5">Date</label>
                            <input type="date" class="form-control form-control-lg" id="event_date" name="event_date"
                                value="{{ request.form.get('event_date', '') }}" min="2026-01-01" max="2029-12-31">
                            <div class="invalid-feedback">Date must be between 2026 and 2029.</div>
                        </div>
                    </div>

                    <!-- Location -->
                    <div class="mb-4">
                        <label for="location" class="form-label fw-bold fs-5">Location</label>
                        <input type="text" class="form-control form-control-lg" id="location" name="location"
                            maxlength="120" placeholder="Where will this take place?"
                            value="{{ request.form.get('location', '') }}">
                        <div class="invalid-feedback">Location is required.</div>
                    </div>

                    <div class="d-flex gap-2 justify-content-end">
                        <a href="{{ url_for('activities.activities_list') }}"
                            class="btn btn-lg btn-outline-secondary">Cancel</a>
                        <button type="submit" class="btn btn-lg btn-primary">Create Activity</button>
                    </div>
                </form>

                <small class="text-muted d-block mt-3">
                    All fields except Attachment and Description are required.
                </small>
            </div>
        </div>
    </div>
</div>

<script>
    (function () {
        const form = document.getElementById('create-activity-form');
        if (!form) return;

        const title = document.getElementById('title');
        const date = document.getElementById('event_date');
        const location = document.getElementById('location');
        const type = document.getElementById('type');

        const MIN_DATE = "2026-01-01";
        const MAX_DATE = "2029-12-31";

        function setInvalid(el, yes) {
            if (yes) el.classList.add('is-invalid');
            else el.classList.remove('is-invalid');
        }

        function isDateInRange(val) {
            if (!val) return false;
            return val >= MIN_DATE && val <= MAX_DATE;
        }

        form.addEventListener('submit', function (e) {
            const t = (title.value || '').trim();
            const d = (date.value || '').trim();
            const l = (location.value || '').trim();
            const ty = (type.value || '').trim();

            let ok = true;

            if (!t) { setInvalid(title, true); ok = false; } else setInvalid(title, false);
            if (!ty) { setInvalid(type, true); ok = false; } else setInvalid(type, false);

            if (!isDateInRange(d)) { setInvalid(date, true); ok = false; }
            else setInvalid(date, false);

            if (!l) { setInvalid(location, true); ok = false; } else setInvalid(location, false);

            if (!ok) e.preventDefault();
        });
    })();
</script>

{% endblock %}