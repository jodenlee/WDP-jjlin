{% extends 'base.html' %}

{% block content %}
<section class="create-story-header">
    <h1>Post a New Story</h1>
</section>

<div class="form-container">
    <form method="POST" class="story-form" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="title" class="form-label fw-bold">Title</label>
            <input type="text" id="title" name="title" class="form-control" required minlength="3" maxlength="100"
                value="{{ form.title if form else '' }}" placeholder="Give your story a title">
            <div class="form-text">Title must be between 3 and 100 characters.</div>
        </div>

        <div class="mb-3">
            <label for="location" class="form-label fw-bold">Location</label>
            <div class="input-group">
                <input type="text" id="location" name="location" list="singapore-locations" class="form-control"
                    maxlength="100" value="{{ form.location if form else '' }}"
                    placeholder="e.g. Toa Payoh Public Library">
                <button type="button" id="use-location-btn" class="btn btn-outline-secondary"
                    onclick="populateLocationField('location', 'use-location-btn')">
                    <i class="fas fa-crosshairs"></i> Use My Location
                </button>
            </div>
            {% include 'partials/locations.html' %}
        </div>
        <script src="{{ url_for('static', filename='js/geolocation.js') }}"></script>

        <div class="mb-3">
            <label class="form-label fw-bold">Upload Images</label>
            <div id="image-inputs-container">
                <div class="input-group mb-2">
                    <input type="file" name="images" class="form-control" accept="image/*">
                    <button type="button" class="btn btn-outline-danger remove-image-btn"
                        style="display:none;">&times;</button>
                </div>
            </div>
            <button type="button" id="add-image-btn"
                class="btn btn-sm btn-outline-primary d-flex align-items-center gap-2">
                <i class="fas fa-plus"></i> Add Another Image
            </button>
            <div class="form-text mt-2">Add images one by one to create a gallery carousel. Supported: jpg, png, webp.
            </div>
        </div>

        <!-- script for dynamic inputs -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const container = document.getElementById('image-inputs-container');
                const addBtn = document.getElementById('add-image-btn');

                addBtn.addEventListener('click', function () {
                    const div = document.createElement('div');
                    div.className = 'input-group mb-2';
                    div.innerHTML = `
                        <input type="file" name="images" class="form-control" accept="image/*">
                        <button type="button" class="btn btn-outline-danger remove-image-btn">&times;</button>
                    `;
                    container.appendChild(div);
                });

                container.addEventListener('click', function (e) {
                    if (e.target.classList.contains('remove-image-btn')) {
                        e.target.parentElement.remove();
                    }
                });
            });
        </script>

        <div class="mb-3">
            <label for="content" class="form-label fw-bold">Story Content</label>
            <textarea id="content" name="content" rows="6" class="form-control" required minlength="10"
                placeholder="Share your memory...">{{ form.content if form else '' }}</textarea>
            <div class="form-text">Share at least 10 characters about your story.</div>
        </div>

        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">Post Story</button>
            <a href="{{ url_for('stories') }}" class="btn btn-outline-secondary">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}