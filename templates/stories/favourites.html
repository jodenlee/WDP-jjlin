{% extends 'base.html' %}

{% block content %}
<section class="stories-header">
    <div class="header-top-row"
        style="position: relative; display: flex; align-items: center; justify-content: center; width: 100%; margin-bottom: 2rem;">
        <a href="{{ url_for('stories') }}" class="btn btn-secondary" style="position: absolute; left: 0;">‚Üê Back to
            Stories</a>
        <h1 style="margin: 0;">My Favourites</h1>
    </div>
</section>

<div class="stories-grid">
    {% if stories %}
    {% for story in stories %}
    {% set bg_image = story['image_url'] or 'https://via.placeholder.com/400x200' %}

    <div class="feed-story-card">
        <!-- Card Link Overlay -->
        <a href="{{ url_for('view_story', story_id=story['id']) }}" class="card-link-overlay"></a>

        <div class="story-header" style="background-image: url('{{ bg_image | safe }}');">
            <div class="header-overlay">
                <!-- Bookmark Form (High Z-Index) -->
                <form action="{{ url_for('toggle_bookmark', story_id=story['id']) }}" method="POST" class="fav-form">
                    <button type="submit" class="btn-icon star-icon" title="Remove Favourite">
                        <!-- Always filled star on favourites page -->
                        ‚òÖ
                    </button>
                </form>
                <span class="category-tag">YOUTH</span>
            </div>
        </div>

        <div class="story-content">
            <h3>{{ story['title'] }}</h3>
            <p>{{ story['content'][:80] }}...</p>
            <div class="story-footer">
                <form action="{{ url_for('toggle_like', story_id=story['id']) }}" method="POST" class="like-form"
                    style="display:inline;">
                    <button type="submit" class="btn-icon like-btn" title="Like">
                        {% if story['id'] in liked_story_ids %}
                        ‚ô•
                        {% else %}
                        ‚ô°
                        {% endif %}
                    </button>
                </form>
                <span class="like-count">{{ story['likes'] }}</span>

                <span class="footer-location" style="margin-left: auto;">üìç {{ story['location'] or 'SG' }}</span>
            </div>
        </div>
    </div>

    {% endfor %}
    {% else %}
    <div style="text-align: center; grid-column: 1/-1;">
        <p>No favourites yet. Go explore and star some stories!</p>
        <a href="{{ url_for('stories') }}" class="btn btn-primary" style="margin-top: 1rem;">Browse Stories</a>
    </div>
    {% endif %}
</div>
{% endblock %}